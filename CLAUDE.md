# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Overview

This is an R package called `gmsp` (Ground Motion Signal Processing Tools) that provides functions for processing ground motion signals including filtering, spectral analysis, Hilbert-Huang Transform, and other signal processing techniques.

## Package Structure

- **R/**: Core R functions for signal processing
  - `get_Spectra.R`: Calculate response spectra from acceleration time series using state-space formulation
  - `build_FFT.R`: Compute FFT amplitude spectrum with zero-padding
  - `build_TS.R`, `build_TS_VT.R`: Time series building functions
  - `get_Intensity.R`: Calculate intensity measures
  - `get_ND.R`: Natural frequency detection
  - `get_imf.R`, `remove_IMF.R`: Intrinsic Mode Function operations for Hilbert-Huang Transform
  - `map_OCID.R`: OCID mapping functionality
  - `smooth_Spectra.R`: Spectral smoothing operations
  - `utils.R`: Utility functions
  - `local.R`: Local processing functions

- **man/**: R documentation files (generated by roxygen2)
- **data-raw/**: Raw data processing scripts
- **inst/**: Installation files and work-in-progress code

## Key Dependencies

The package imports several R packages for signal processing:
- `data.table`: Data manipulation
- `pracma`: Practical numerical math functions
- `seewave`, `signal`: Signal processing
- `spectral`: Spectral analysis
- `hht`, `EMD`: Hilbert-Huang Transform and Empirical Mode Decomposition
- `expm`: Matrix exponential calculations
- `zoo`: Time series objects

## Common Development Commands

### Building and Installing
```bash
R CMD build .          # Build source package
R CMD INSTALL .        # Install package locally
R CMD check .          # Check package for errors
```

### Testing
The package uses testthat for testing:
```bash
R -e "devtools::test()"
R -e "testthat::test_dir('tests')"
```

### Documentation
Documentation is generated using roxygen2:
```bash
R -e "devtools::document()"     # Generate documentation
R -e "roxygen2::roxygenise()"   # Alternative documentation generation
```

### Loading for Development
```bash
R -e "devtools::load_all()"     # Load package for development
```

## Core Functionality

The package focuses on earthquake ground motion processing with two main computational approaches:

1. **Response Spectra Calculation** (`get_Spectra`): Uses state-space formulation with matrix exponential method to compute pseudo-spectral acceleration for SDOF oscillators
2. **Fourier Analysis** (`build_FFT`): Implements FFT with zero-padding for improved frequency resolution

Both functions accept either data.table objects with 's' (signal) and 't' (time) columns or separate numeric vectors.

## Code Conventions

- Functions use snake_case naming
- Extensive roxygen2 documentation with @description, @param, @return, @details, and @examples
- Functions often accept both data.table and vector inputs for flexibility
- Memory cleanup with `on.exit(rm(list = ls()))` in main functions
- Default parameters for common use cases (e.g., 5% damping ratio for response spectra)